#!/bin/bash
set -euo pipefail

sourcelanguages="$1"
targetlanguages="$2"
dsets="dev test"

input_dir="parallel"
output_dir="eval"

mkdir -p "$output_dir"
for dset in $dsets; do
    for src in $sourcelanguages; do
        for tgt in $targetlanguages; do
            [[ $src = "$tgt" ]] && continue

            #cat "$input_dir/$dset.$src-$tgt.$src" | preprocess_source_data "$src" "$tgt" > "$output_dir/$dset.$src-$tgt.$src"
            #cat "$input_dir/$dset.$src-$tgt.$tgt" > "$output_dir/$dset.$src-$tgt.$tgt"
            #"$SCRIPT_DIR"/scripts/preprocess/purge-empty-lines.sh "" \
            #    "$output_dir/$dset.$src-$tgt.$src" "$output_dir/$dset.$src-$tgt.$tgt"

            cat "$input_dir/$dset.$src-$tgt.$src" | preprocess_source_data "$src" "$tgt" |
                paste - "$input_dir/$dset.$src-$tgt.$tgt" |
                grep -v "^$" |
                unpaste "$output_dir/$dset.$src-$tgt.$src" "$output_dir/$dset.$src-$tgt.$tgt"
        done
    done
done
